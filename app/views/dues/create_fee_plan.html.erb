<div class="row">
  <%= render partial: 'shared/fee_navigation' %>
</div>

<div class="bg-light lter b-b wrapper-md">
  <h1 class="m-n font-thin h3">Create fee Plan</h1>
</div>
<br><br>
<%= form_for @student, url: save_fee_plan_path, method: 'post' do |f| %>
    <div class="row">
      <div class="col-sm-1"></div>
      <div class="col-sm-2"></div>
      <div class="col-sm-2"><h4>Mode</h4></div>
      <div class="col-sm-2"><h4>Total</h4></div>
      <div class="col-sm-2"><h4>Paid</h4></div>
      <div class="col-sm-2"><h4>Balance</h4></div>

    </div>
    <%= f.hidden_field :id %>
    <%= f.fields_for :dues do |d| %>
        <div class="row">
          <div class="col-sm-1"><%= d.check_box :show, {class: 'fee-select', id: d.object.id} %></div>
          <div class="col-sm-2"><span style="font-size: 22px;"><%= d.object.feeable.name %></span></div>
          <%= d.hidden_field :feeable_id %>
          <%= d.hidden_field :feeable_type %>
          <%= d.hidden_field :grade_id %>
          <div class="col-sm-2">
            <%= d.select :mode_id, options_from_collection_for_select(FeeMode.order('no_of_payments'), :id, :name), {}, {class: 'form-control'} %>
          </div>
          <div class="col-sm-2">
            <%= d.text_field :total, class: "form-control total_#{d.object.id}", readonly: true, value: d.object.feeable.total_amount %>
          </div>

          <div class="col-sm-2">
            <%= d.text_field :paid, class: "form-control paid_#{d.object.id}" %>
          </div>

          <div class="col-sm-2">
            <%= d.text_field :balance, class: 'form-control', readonly: true %>
          </div>
        </div>

    <% end %>
    <div class="col-md-12 actions" style="margin-top: 10px;">
      <%= f.submit 'Save Fee Plan', class: 'btn btn-success pull-right' %>
    </div>
<% end %>

<div class="row">
  <div class="col-md-12">
    <h3>Grand Total: <span class="total"><%= @student.dues.where(show: true).try(:sum, :total) || 0.00 %></span></h3>
  </div>

  <div class="col-md-12">
    <h3>Total Paid: <span class="paid"><%= @student.dues.where(show: true).try(:sum, :paid) || 0.00 %></span></h3>
  </div>
</div>

<script type="text/javascript">
  $('.fee-select').on('click', function(){

    var total = $('.total_'+$(this).attr('id')).val();
    total = parseFloat(total);
    var paid = $('.paid_'+$(this).attr('id')).val();
    paid = parseFloat(paid);

    var grand_total = $('.total').html();
    grand_total = parseFloat(grand_total);

    var grand_paid = $('.paid').html();
    grand_paid = parseFloat(grand_paid);

    if($(this).is(':checked')){
      grand_total = grand_total + total;
      grand_paid = grand_paid + paid;
    }
    else{
      grand_total = grand_total - total;
      grand_paid = grand_paid - paid;
    }
    $('.total').html(grand_total);
    $('.paid').html(grand_paid);

  });

</script>