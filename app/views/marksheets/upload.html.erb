<div class="well well-lg">
	<% @marks.each do |m| %>
		<% if @grade.report_card_settings.find_by_exam_id(@exam.id).take_exam && m.name == 'Quiz'%>
		<% else %>
			<%= link_to m.name, upload_marksheets_path({id: @marksheet.id, mark_id: m.id}), class: "btn btn-info" %>
		<% end %>
	<% end %>
</div>
<br><br>
<%= form_tag(uploading_marksheets_path, method: :post, class: 'col-form') do %>
<div class="performance-area">
	<div class="pull-right">
		<input type="button" value = "Add More" id = "addmore" class="btn btn-primary">
		<%= submit_tag 'Save', class: "btn btn-info" %>
	</div>
	<br><br><br>
	<%= hidden_field_tag :mark_id, @mark.id %>
	<%= hidden_field_tag :marksheet_id, @marksheet.id %>
	<div style=" 	width: 1050px; /* arbitary for demo only */
	white-space: nowrap;
	overflow-y: hidden;
	overflow-x: scroll;
	-webkit-overflow-scrolling: touch;">

		<div class="well well-lg col-md-4" style="min-height:500px; float:none !important;display: inline-block;vertical-align: top;">

			<span style= "background:green; color:white;padding: 7px 80px;font-size: 23px">Student Name</span>
			<div class="performance-holder">
				<% @students.try(:each) do |std| %>
					<strong class="student-names" ><%= std.fullname %> </strong>
				<% end %>
			</div>
		</div>

		<div class="well well-lg col-md-2 performance-report" style="min-height:500px; float:none !important;display: inline-block;vertical-align: top; ">

			<h5> Performance Report</h5>
			<div class="performance-holder">
				<% @students.try(:each) do |std| %>
					<%= link_to 'Performance Report', new_performance_path({student_id: std.id, bridge_id: @marksheet.bridge_id}), class: "btn-performance-report btn btn-primary", style: "font-size:11px;" %>
				<% end %>
			</div>
		</div>

		<% @data.keys.try(:each) do |k| %>
			<div class="well well-lg con col-md-2" style="padding:10px;min-height:500px; width: 200px;float:none !important;display: inline-block;vertical-align: top;">
				<h5><%= @mark.name %></h5>
				<%= text_field_tag "up_date[]", k, style:"", disabled: "true", class: "absense-input" %>

				<% @data[k].try(:each) do |dt| %>
					<%= text_field_tag "up_mark[#{dt.id}]", dt.marks, style:"", class: "absense-input calc"+dt.student_id.to_s %>
				<% end %>

				<%= link_to "Delete", marksheet_path({id: k, marksheet_id: @marksheet.id}), method: 'delete', class: "btn btn-info", style: "margin-left: 60px" %>
			</div>
		<% end %>

		<% if @data.empty? %>
			<div class="well well-lg col-md-2 con" style="padding:10px;min-height:500px;width: 180px;float:none !important;display:inline-block;vertical-align: top;">
				<h5><%= @mark.name %></h5>
				<%= text_field_tag "marks_date[]", '', style:"" , class: "datepickerss absense-input", required: true, placeholder: "Select Date" %>
				<% @students.try(:each) do |std| %>
					<%= text_field_tag "marks[#{std.id}][]" , '' ,class: " absense-input calculate"+std.id.to_s %>
				<% end %>
			</div>
		<% end %>

		<div class="well well-lg col-md-2 " style="padding:10px;min-height:500px;width: 180px;float:none !important;display: inline-block;vertical-align: top; margin-left:10px">
			<h5><%= "Average	" %></h5>
			<%= text_field_tag "max_mark", @mark.marks, style:"" , class: "absense-input datepickerss", required: true, disabled: true%>
			<% @students.try(:each) do |std| %>
				<%= text_field_tag "marks[#{std.id}][]",'' ,disabled: true, id: std.id, class: "absense-input total"+std.id.to_s %>
			<% end %>
		</div>

	</div>
</div>
<% end %>

<script type="text/javascript">

	$("#addmore").on("click", function (){
		console.log("I am here");
		var html = $($('.col-template').html());
		console.log(html);
		html.insertAfter($('.col-form .con').last());
		$(".datepickerss").datepicker();
	});
	$(".datepickerss").datepicker();

	<% @students.try(:each) do |std| %>
		$(document).on("blur", '.calc<%= std.id.to_s %>', function(){
			var sum = 0
			var av = -1
			$('.calc<%= std.id.to_s %>').each(function(i, obj) {
				if (obj.value != '')
				{
					sum = sum + parseFloat(obj.value);
				}
				av = av+1
			});
			console.log(sum);
			console.log(av);

			$(".total<%=std.id.to_s%>").val(Math.round(sum/av).toFixed(2));
		});
	<% end %>

</script>

<div class="col-template hidden">
	<div class="well well-lg con" style="padding:10px;min-height:500px;width: 180px; float:none !important;display: inline-block;vertical-align: top;">
		<h5><%= @mark.name %></h5>
		<%= text_field_tag "marks_date[]", '' ,class: "datepickerss absense-input", required: true, placeholder: "Select Date" %>
		<% @students.try(:each) do |std| %>
			<%= text_field_tag "marks[#{std.id}][]", "" ,class: "absense-input calc"+std.id.to_s %>
		<% end %>
	</div>
</div>