<div class="bg-light lter b-b wrapper-md">
  <h1 class="m-n font-thin h3">Publish Result For <%= @grade.full_name %> <button class="btn btn-info enable pull-right">Publish</button>
  </h1>
</div>
<table id="example" class="table table-striped table-bordered table-responsive" >
  <thead class= "table-head">
    <tr>
      <th class="control-checkbox" style = "width: 15px;" >All</th>
      <th style = "width: 90px;">Student ID</th>
      <th style = "width: 90px;">Name</th>
      <th style = "width: 90px;">Email</th>
      <th style = "width: 90px;">Fathers Name</th>
    </tr>
  </thead>

  <tbody>
    <% @students.each do |std| %>
      <tr>
        <td> <input type="checkbox" class="select-std" value="<%= std.id %>" <%= std.publish_result ? 'checked' : '' %> ></td>
        <td><%= std.rollnumber %></td>
        <td><%= std.fullname %></td>
        <td><%= std.email %></td>
        <td><%= std.father_name %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<script type="text/javascript">

  $('.enable').on('click', function(){
  	var ids = '';
    $('.select-std:checked').each(function(){
      ids += $(this).val() + ','
    });
    console.log(ids)
    if (confirm('Are you sure you want to publish result?')) {
      if(ids === ''){
        alert('Please Select At Least One User.');
      }else {
        ids = ids.slice(0, -1);
        sendRequest(ids, '/grades/publish_result_for_selected_students', true)
      }
    }
  });

  function sendRequest(ids, url, value){
    $.ajax({
      url: url,
      data: {
        ids: ids,
        value: value
      },
      dataType: 'script',
      method: 'POST'
    });
  }
</script>