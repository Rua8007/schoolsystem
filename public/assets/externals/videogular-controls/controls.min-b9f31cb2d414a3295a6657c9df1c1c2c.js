"use strict";angular.module("com.2fdevs.videogular.plugins.controls",[]).directive("vgControls",["$timeout",function(e){return{restrict:"E",require:"^videogular",transclude:!0,template:'<div id="controls-container" ng-mousemove="onMouseMove()" ng-class="animationClass" ng-transclude></div>',scope:{autoHide:"=vgAutohide",autoHideTime:"=vgAutohideTime"},link:function(t){function n(){t.animationClass="hide-animation"}function i(){t.animationClass="show-animation",e.cancel(o),t.autoHide&&(o=e(n,u))}var o,u=2e3;t.onMouseMove=function(){t.autoHide&&i()},void 0!=t.autoHide&&t.$watch("autoHide",function(n){n?t.animationClass="hide-animation":(t.animationClass="",e.cancel(o),i())}),void 0!=t.autoHideTime&&t.$watch("autoHideTime",function(e){u=e})}}}]).directive("vgPlayPauseButton",["VG_STATES",function(e){return{restrict:"E",require:"^videogular",template:"<button class='iconButton' ng-click='onClickPlayPause()' ng-class='playPauseIcon' aria-label='Play/Pause' type='button'></button>",link:function(t,n,i,o){function u(n){switch(n){case e.PLAY:t.playPauseIcon={pause:!0};break;case e.PAUSE:t.playPauseIcon={play:!0};break;case e.STOP:t.playPauseIcon={play:!0}}}t.onClickPlayPause=function(){o.playPause()},t.playPauseIcon={play:!0},t.$watch(function(){return o.currentState},function(e,t){e!=t&&u(e)})}}}]).directive("vgTimedisplay",[function(){return{require:"^videogular",restrict:"E",link:function(e,t,n,i){e.currentTime=i.currentTime,e.timeLeft=i.timeLeft,e.totalTime=i.totalTime,e.isLive=i.isLive,e.$watch(function(){return i.currentTime},function(t,n){t!=n&&(e.currentTime=t)}),e.$watch(function(){return i.timeLeft},function(t,n){t!=n&&(e.timeLeft=t)}),e.$watch(function(){return i.totalTime},function(t,n){t!=n&&(e.totalTime=t)}),e.$watch(function(){return i.isLive},function(t,n){t!=n&&(e.isLive=t)})}}}]).directive("vgScrubbar",["VG_STATES","VG_UTILS",function(e,t){return{restrict:"E",require:"^videogular",transclude:!0,template:'<div role="slider" aria-valuemax="{{ariaTime(API.totalTime)}}" aria-valuenow="{{ariaTime(API.currentTime)}}" aria-valuemin="0" aria-label="Time scrub bar" tabindex="0" ng-transclude ng-keydown="onScrubBarKeyDown($event)"></div>',link:function(n,i,o,u){function l(e){var o,l=e.originalEvent||e,c=l.touches;h=t.isiOSDevice()?-1*(c[0].clientX-l.layerX):l.layerX,o=c[0].clientX+h-c[0].target.offsetLeft,p=!0,b&&(y=!0),u.pause(),d(o*u.mediaElement[0].duration/i[0].scrollWidth),n.$apply()}function c(e){e.originalEvent||e,y&&(y=!1,u.play()),p=!1,n.$apply()}function a(e){var t,o=e.originalEvent||e,l=o.touches;p&&(t=l[0].clientX+h-l[0].target.offsetLeft,d(t*u.mediaElement[0].duration/i[0].scrollWidth)),n.$apply()}function r(){p=!1,n.$apply()}function s(e){e=t.fixEventOffset(e),p=!0,b&&(y=!0),u.pause(),d(e.offsetX*u.mediaElement[0].duration/i[0].scrollWidth),n.$apply()}function m(e){e=t.fixEventOffset(e),y&&(y=!1,u.play()),p=!1,d(e.offsetX*u.mediaElement[0].duration/i[0].scrollWidth),n.$apply()}function f(e){p&&(e=t.fixEventOffset(e),d(e.offsetX*u.mediaElement[0].duration/i[0].scrollWidth)),n.$apply()}function v(){p=!1,n.$apply()}function d(e){u.seekTime(e,!1)}function g(t){if(!p)switch(t){case e.PLAY:b=!0;break;case e.PAUSE:b=!1;break;case e.STOP:b=!1}}var p=!1,b=!1,y=!1,h=0,T=37,V=39,k=5;n.API=u,n.ariaTime=function(e){return 0===e?"0":Math.round(e.getTime()/1e3)},n.onScrubBarKeyDown=function(e){var t=u.currentTime.getTime()-6e4*u.totalTime.getTimezoneOffset(),n=u.totalTime.getTime()-6e4*u.totalTime.getTimezoneOffset(),i=t/n*100;e.which===T||e.keyCode===T?(u.seekTime(i-k,!0),e.preventDefault()):(e.which===V||e.keyCode===V)&&(u.seekTime(i+k,!0),e.preventDefault())},n.$watch(function(){return u.currentState},function(e,t){e!=t&&g(e)}),t.isMobileDevice()?(i.bind("touchstart",l),i.bind("touchend",c),i.bind("touchmove",a),i.bind("touchleave",r)):(i.bind("mousedown",s),i.bind("mouseup",m),i.bind("mousemove",f),i.bind("mouseleave",v))}}}]).directive("vgScrubbarcurrenttime",[function(){return{restrict:"E",require:"^videogular",link:function(e,t,n,i){function o(e){if(e&&i.totalTime){var n=e.getTime()-6e4*i.totalTime.getTimezoneOffset(),o=i.totalTime.getTime()-6e4*i.totalTime.getTimezoneOffset();l=-1*n/1e3*100/(-1*o/1e3),t.css("width",l+"%")}}function u(){l=0,t.css("width",l+"%")}var l=0;e.$watch(function(){return i.currentTime},function(e){o(e)}),e.$watch(function(){return i.isCompleted},function(e){u(e)})}}}]).directive("vgVolume",["VG_UTILS",function(e){return{restrict:"E",link:function(t,n){function i(){t.volumeVisibility="visible",t.$apply()}function o(){t.volumeVisibility="hidden",t.$apply()}e.isMobileDevice()?n.css("display","none"):(t.volumeVisibility="hidden",n.bind("mouseover",i),n.bind("mouseleave",o))}}}]).directive("vgVolumebar",["VG_UTILS",function(e){return{restrict:"E",require:"^videogular",template:"<div class='verticalVolumeBar'><div class='volumeBackground' ng-click='onClickVolume($event)' ng-mousedown='onMouseDownVolume()' ng-mouseup='onMouseUpVolume()' ng-mousemove='onMouseMoveVolume($event)' ng-mouseleave='onMouseLeaveVolume()'><div class='volumeValue'></div><div class='volumeClickArea'></div></div></div>",link:function(t,n,i,o){function u(e){e=100*e,r.css("height",e+"%"),r.css("top",100-e+"%")}function l(e){n.css("visibility",e)}var c=!1,a=angular.element(n[0].getElementsByClassName("volumeBackground")),r=angular.element(n[0].getElementsByClassName("volumeValue"));t.onClickVolume=function(t){t=e.fixEventOffset(t);var n=parseInt(a.prop("offsetHeight")),i=100*t.offsetY/n,u=1-i/100;o.setVolume(u)},t.onMouseDownVolume=function(){c=!0},t.onMouseUpVolume=function(){c=!1},t.onMouseLeaveVolume=function(){c=!1},t.onMouseMoveVolume=function(t){if(c){t=e.fixEventOffset(t);var n=parseInt(a.prop("offsetHeight")),i=100*t.offsetY/n,u=1-i/100;o.setVolume(u)}},n.css("visibility",t.volumeVisibility),t.$watch("volumeVisibility",l),t.$watch(function(){return o.volume},function(e,t){e!=t&&u(e)})}}}]).directive("vgMutebutton",[function(){return{restrict:"E",require:"^videogular",template:"<button class='iconButton' ng-class='muteIcon' ng-click='onClickMute()' ng-focus='onMuteButtonFocus()' ng-blur='onMuteButtonLoseFocus()' ng-keydown='onMuteButtonKeyDown($event)' aria-label='Mute' type='button'></button>",link:function(e,t,n,i){function o(t){e.currentVolume=t,u?t>0&&(e.defaultVolume=t):e.defaultVolume=t;var n=Math.round(100*t);0==n?e.muteIcon={mute:!0}:n>0&&25>n?e.muteIcon={level0:!0}:n>=25&&50>n?e.muteIcon={level1:!0}:n>=50&&75>n?e.muteIcon={level2:!0}:n>=75&&(e.muteIcon={level3:!0})}var u=!1,l=38,c=40,a=.05;e.onClickMute=function(){u?e.currentVolume=e.defaultVolume:(e.currentVolume=0,e.muteIcon={mute:!0}),u=!u,i.setVolume(e.currentVolume)},e.onMuteButtonFocus=function(){e.volumeVisibility="visible"},e.onMuteButtonLoseFocus=function(){e.volumeVisibility="hidden"},e.onMuteButtonKeyDown=function(e){var t,n=null!=i.volume?i.volume:1;e.which===l||e.keyCode===l?(t=n+a,t>1&&(t=1),i.setVolume(t),e.preventDefault()):(e.which===c||e.keyCode===c)&&(t=n-a,0>t&&(t=0),i.setVolume(t),e.preventDefault())},e.defaultVolume=1,e.currentVolume=e.defaultVolume,e.muteIcon={level3:!0},e.$watch(function(){return i.volume},function(e,t){e!=t&&o(e)})}}}]).directive("vgFullscreenbutton",[function(){return{restrict:"E",require:"^videogular",scope:{vgEnterFullScreenIcon:"=",vgExitFullScreenIcon:"="},template:"<button class='iconButton' ng-click='onClickFullScreen()' ng-class='fullscreenIcon' aria-label='Toggle full screen' type='button'></button>",link:function(e,t,n,i){function o(t){e.fullscreenIcon={enter:!t,exit:t}}e.onClickFullScreen=function(){i.toggleFullScreen()},e.fullscreenIcon={exit:!1},e.fullscreenIcon={enter:!0},e.$watch(function(){return i.isFullScreen},function(e,t){e!=t&&o(e)})}}}]);