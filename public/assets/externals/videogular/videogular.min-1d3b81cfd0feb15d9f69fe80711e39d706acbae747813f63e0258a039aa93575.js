"use strict";angular.module("com.2fdevs.videogular",["ngSanitize"]).constant("VG_STATES",{PLAY:"play",PAUSE:"pause",STOP:"stop"}).service("VG_UTILS",function(){this.fixEventOffset=function(e){if(navigator.userAgent.match(/Firefox/i)){var t=e.currentTarget.currentStyle||window.getComputedStyle(e.target,null),n=parseInt(t.borderLeftWidth,10),r=parseInt(t.borderTopWidth,10),i=e.currentTarget.getBoundingClientRect(),a=e.clientX-n-i.left,l=e.clientY-r-i.top;e.offsetX=a,e.offsetY=l}return e},this.getZIndex=function(){var e=1;return angular.element("*").filter(function(){return"auto"!==angular.element(this).css("zIndex")}).each(function(){var t=parseInt(angular.element(this).css("zIndex"));t>e&&(e=t+1)}),e},this.toUTCDate=function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},this.secondsToDate=function(e){isNaN(e)&&(e=0);var t=new Date;return t.setTime(1e3*e),t=this.toUTCDate(t)},this.isMobileDevice=function(){return"undefined"!=typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},this.isiOSDevice=function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)}}).run(["$window","VG_UTILS",function(e,t){var n,r={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",onchange:"fullscreenchange",onerror:"fullscreenerror"},newWebkit:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},oldWebkit:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",onchange:"mozfullscreenchange",onerror:"mozfullscreenerror"},ios:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitEnterFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",onchange:"msfullscreenchange",onerror:"msfullscreenerror"}};for(var i in r)if(r[i].enabled in document){n=r[i],n.isFullScreen=function(){return null!=document[this.element]};break}t.isiOSDevice()&&(n=r.ios,n.isFullScreen=function(){return null!=document[this.element]}),angular.element(e)[0].fullScreenAPI=n}]).directive("videogular",["$window","VG_STATES","VG_UTILS",function(e,t,n){return{restrict:"E",scope:{theme:"=vgTheme",autoPlay:"=vgAutoplay",vgComplete:"&",vgUpdateVolume:"&",vgUpdateTime:"&",vgUpdateState:"&",vgPlayerReady:"&",vgChangeSource:"&",vgError:"&"},controller:["$scope","$timeout",function(r){var i=null,a=!1,l=!1,o=r.vgComplete(),u=r.vgUpdateVolume(),c=r.vgUpdateTime(),s=r.vgUpdateState(),d=r.vgPlayerReady(),m=r.vgChangeSource(),g=r.vgError();this.videogularElement=null,this.clearMedia=function(){r.API.mediaElement[0].src=""},this.onCanPlay=function(){r.API.isBuffering=!1,r.$apply()},this.onVideoReady=function(){r.API.isReady=!0,r.API.autoPlay=r.autoPlay,r.API.currentState=t.STOP,l=!0,r.vgPlayerReady()&&(d=r.vgPlayerReady())(r.API)},this.onLoadMetaData=function(e){r.API.isBuffering=!1,r.API.onUpdateTime(e)},this.onUpdateTime=function(e){r.API.currentTime=n.secondsToDate(e.target.currentTime),1/0!=e.target.duration?(r.API.totalTime=n.secondsToDate(e.target.duration),r.API.timeLeft=n.secondsToDate(e.target.duration-e.target.currentTime),r.API.isLive=!1):r.API.isLive=!0,r.vgUpdateTime()&&(c=r.vgUpdateTime())(e.target.currentTime,e.target.duration),r.$apply()},this.onPlay=function(){r.API.setState(t.PLAY),r.$apply()},this.onPause=function(){r.API.setState(t.PAUSE),r.$apply()},this.onVolumeChange=function(){r.API.volume=r.API.mediaElement[0].volume,r.$apply()},this.seekTime=function(e,t){var i;t?(i=e*r.API.mediaElement[0].duration/100,r.API.mediaElement[0].currentTime=i):(i=e,r.API.mediaElement[0].currentTime=i),r.API.currentTime=n.secondsToDate(i)},this.playPause=function(){r.API.mediaElement[0].paused?this.play():this.pause()},this.setState=function(e){return e&&e!=r.API.currentState&&(r.vgUpdateState()&&(s=r.vgUpdateState())(e),r.API.currentState=e),r.API.currentState},this.play=function(){r.API.mediaElement[0].play(),this.setState(t.PLAY)},this.pause=function(){r.API.mediaElement[0].pause(),this.setState(t.PAUSE)},this.stop=function(){r.API.mediaElement[0].pause(),r.API.mediaElement[0].currentTime=0,this.setState(t.STOP)},this.toggleFullScreen=function(){angular.element(e)[0].fullScreenAPI?angular.element(e)[0].fullScreenAPI.isFullScreen()?n.isMobileDevice()||document[angular.element(e)[0].fullScreenAPI.exit]():n.isMobileDevice()?n.isiOSDevice()?l?this.enterElementInFullScreen(r.API.mediaElement[0]):(a=!0,this.play()):this.enterElementInFullScreen(r.API.mediaElement[0]):this.enterElementInFullScreen(r.API.videogularElement[0]):(r.API.isFullScreen?(r.API.videogularElement.removeClass("fullscreen"),r.API.videogularElement.css("z-index",0)):(r.API.videogularElement.addClass("fullscreen"),r.API.videogularElement.css("z-index",n.getZIndex())),r.API.isFullScreen=!r.API.isFullScreen)},this.enterElementInFullScreen=function(t){t[angular.element(e)[0].fullScreenAPI.request]()},this.changeSource=function(e){r.vgChangeSource()&&(m=r.vgChangeSource())(e)},this.setVolume=function(e){r.vgUpdateVolume()&&(u=r.vgUpdateVolume())(e),r.API.mediaElement[0].volume=e,r.API.volume=e},this.updateTheme=function(e){if(i)for(var t=document.getElementsByTagName("link"),n=0,r=t.length;r>n;n++)t[n].outerHTML.indexOf(i)>=0&&t[n].parentNode.removeChild(t[n]);if(e){var a=angular.element(document).find("head");a.append("<link rel='stylesheet' href='"+e+"'>"),i=e}},this.onStartBuffering=function(){r.API.isBuffering=!0,r.$apply()},this.onStartPlaying=function(){r.API.isBuffering=!1,r.$apply()},this.onComplete=function(){r.vgComplete()&&(o=r.vgComplete())(),r.API.setState(t.STOP),r.API.isCompleted=!0,r.$apply()},this.onVideoError=function(e){r.vgError()&&(g=r.vgError())(e)},this.addListeners=function(){r.API.mediaElement[0].addEventListener("canplay",r.API.onCanPlay,!1),r.API.mediaElement[0].addEventListener("loadedmetadata",r.API.onLoadMetaData,!1),r.API.mediaElement[0].addEventListener("waiting",r.API.onStartBuffering,!1),r.API.mediaElement[0].addEventListener("ended",r.API.onComplete,!1),r.API.mediaElement[0].addEventListener("playing",r.API.onStartPlaying,!1),r.API.mediaElement[0].addEventListener("play",r.API.onPlay,!1),r.API.mediaElement[0].addEventListener("pause",r.API.onPause,!1),r.API.mediaElement[0].addEventListener("volumechange",r.API.onVolumeChange,!1),r.API.mediaElement[0].addEventListener("timeupdate",r.API.onUpdateTime,!1),r.API.mediaElement[0].addEventListener("error",r.API.onVideoError,!1)},r.API=this,r.init=function(){r.API.isReady=!1,r.API.isCompleted=!1,r.API.currentTime=n.secondsToDate(0),r.API.totalTime=n.secondsToDate(0),r.API.timeLeft=n.secondsToDate(0),r.API.isLive=!1,r.API.updateTheme(r.theme),r.addBindings(),angular.element(e)[0].fullScreenAPI&&document.addEventListener(angular.element(e)[0].fullScreenAPI.onchange,r.onFullScreenChange)},r.addBindings=function(){r.$watch("theme",function(e,t){e!=t&&r.API.updateTheme(e)}),r.$watch("autoPlay",function(e,t){e!=t&&e&&r.API.play()})},r.onFullScreenChange=function(){r.API.isFullScreen=angular.element(e)[0].fullScreenAPI.isFullScreen(),r.$apply()},r.$on("$destroy",this.clearMedia),r.$on("$routeChangeStart",this.clearMedia),r.init()}],link:{pre:function(e,t,n,r){r.videogularElement=angular.element(t)}}}}]).directive("vgVideo",["$compile","$timeout","VG_UTILS","VG_STATES",function(e,t,n,r){return{restrict:"E",require:"^videogular",scope:{vgSrc:"=",vgLoop:"=",vgPreload:"=",vgNativeControls:"=",vgTracks:"="},link:function(i,a,l,o){function u(){if(s="",o.mediaElement[0].canPlayType){for(var e=0,i=c.length;i>e;e++)if(s=o.mediaElement[0].canPlayType(c[e].type),"maybe"==s||"probably"==s){o.mediaElement.attr("src",c[e].src),o.mediaElement.attr("type",c[e].type);break}}else o.mediaElement.attr("src",c[0].src),o.mediaElement.attr("type",c[0].type);t(function(){(o.autoPlay&&!n.isMobileDevice()||o.currentState===r.PLAY)&&o.play()}),""==s&&o.onVideoError()}var c,s;i.$watch("vgSrc",function(e,t){c&&e==t||!e||(c=e,o.sources=c,u())}),o.sources=i.vgSrc,o.mediaElement=angular.element('<video vg-source="vgSrc"></video>');var d=e(o.mediaElement)(i);o.addListeners(),a.append(d),o.onVideoReady()}}}]).directive("vgAudio",["$compile","$timeout","VG_UTILS","VG_STATES",function(e,t,n,r){return{restrict:"E",require:"^videogular",scope:{vgSrc:"=",vgLoop:"=",vgPreload:"=",vgNativeControls:"=",vgTracks:"="},link:function(i,a,l,o){function u(){if(s="",o.mediaElement[0].canPlayType){for(var e=0,i=c.length;i>e;e++)if(s=o.mediaElement[0].canPlayType(c[e].type),"maybe"==s||"probably"==s){o.mediaElement.attr("src",c[e].src),o.mediaElement.attr("type",c[e].type);break}}else o.mediaElement.attr("src",c[0].src),o.mediaElement.attr("type",c[0].type);t(function(){(o.autoPlay&&!n.isMobileDevice()||o.currentState===r.PLAY)&&o.play()})}var c,s;i.$watch("vgSrc",function(e,t){c&&e==t||!e||(c=e,o.sources=c,u())}),o.sources=i.vgSrc,o.mediaElement=angular.element('<audio vg-source="vgSrc"></audio>');var d=e(o.mediaElement)(i);o.addListeners(),a.append(d),o.onVideoReady()}}}]).directive("vgTracks",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(e,t,n,r){function i(){var e,t,n=r.mediaElement.children();for(e=0,t=n.length;t>e;e++)n[e].remove();if(a)for(e=0,t=a.length;t>e;e++){l="",l+="<track ";for(var i in a[e])l+=i+'="'+a[e][i]+'" ';l+="></track>",r.mediaElement.append(l)}}var a,l;e.$watch(n.vgTracks,function(e,t){a&&e==t||(a=e,r.tracks=a,i())})}}}}]).directive("vgLoop",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(e,t,n,r){var i;e.$watch(n.vgLoop,function(e,t){i&&e==t||!e?r.mediaElement.removeAttr("loop"):(i=e,r.mediaElement.attr("loop",i))})}}}}]).directive("vgPreload",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(e,t,n,r){var i;e.$watch(n.vgPreload,function(e,t){i&&e==t||!e?r.mediaElement.removeAttr("preload"):(i=e,r.mediaElement.attr("preload",i))})}}}}]).directive("vgNativeControls",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(e,t,n,r){var i;e.$watch(n.vgNativeControls,function(e,t){i&&e==t||!e?r.mediaElement.removeAttr("controls"):(i=e,r.mediaElement.attr("controls",""))})}}}}]);